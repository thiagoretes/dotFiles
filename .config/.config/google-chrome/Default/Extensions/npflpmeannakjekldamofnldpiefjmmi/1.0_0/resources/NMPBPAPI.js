window.NMP||function(){var e,t,n;(function(r){function v(e,t){return h.call(e,t)}function m(e,t){var n,r,i,s,o,u,a,f,c,h,p,v=t&&t.split("/"),m=l.map,g=m&&m["*"]||{};if(e&&e.charAt(0)===".")if(t){v=v.slice(0,v.length-1),e=e.split("/"),o=e.length-1,l.nodeIdCompat&&d.test(e[o])&&(e[o]=e[o].replace(d,"")),e=v.concat(e);for(c=0;c<e.length;c+=1){p=e[c];if(p===".")e.splice(c,1),c-=1;else if(p===".."){if(c===1&&(e[2]===".."||e[0]===".."))break;c>0&&(e.splice(c-1,2),c-=2)}}e=e.join("/")}else e.indexOf("./")===0&&(e=e.substring(2));if((v||g)&&m){n=e.split("/");for(c=n.length;c>0;c-=1){r=n.slice(0,c).join("/");if(v)for(h=v.length;h>0;h-=1){i=m[v.slice(0,h).join("/")];if(i){i=i[r];if(i){s=i,u=c;break}}}if(s)break;!a&&g&&g[r]&&(a=g[r],f=c)}!s&&a&&(s=a,u=f),s&&(n.splice(0,u,s),e=n.join("/"))}return e}function g(e,t){return function(){return s.apply(r,p.call(arguments,0).concat([e,t]))}}function y(e){return function(t){return m(t,e)}}function b(e){return function(t){a[e]=t}}function w(e){if(v(f,e)){var t=f[e];delete f[e],c[e]=!0,i.apply(r,t)}if(!v(a,e)&&!v(c,e))throw new Error("No "+e);return a[e]}function E(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function S(e){return function(){return l&&l.config&&l.config[e]||{}}}var i,s,o,u,a={},f={},l={},c={},h=Object.prototype.hasOwnProperty,p=[].slice,d=/\.js$/;o=function(e,t){var n,r=E(e),i=r[0];return e=r[1],i&&(i=m(i,t),n=w(i)),i?n&&n.normalize?e=n.normalize(e,y(t)):e=m(e,t):(e=m(e,t),r=E(e),i=r[0],e=r[1],i&&(n=w(i))),{f:i?i+"!"+e:e,n:e,pr:i,p:n}},u={require:function(e){return g(e)},exports:function(e){var t=a[e];return typeof t!="undefined"?t:a[e]={}},module:function(e){return{id:e,uri:"",exports:a[e],config:S(e)}}},i=function(e,t,n,i){var s,l,h,p,d,m=[],y=typeof n,E;i=i||e;if(y==="undefined"||y==="function"){t=!t.length&&n.length?["require","exports","module"]:t;for(d=0;d<t.length;d+=1){p=o(t[d],i),l=p.f;if(l==="require")m[d]=u.require(e);else if(l==="exports")m[d]=u.exports(e),E=!0;else if(l==="module")s=m[d]=u.module(e);else if(v(a,l)||v(f,l)||v(c,l))m[d]=w(l);else{if(!p.p)throw new Error(e+" missing "+l);p.p.load(p.n,g(i,!0),b(l),{}),m[d]=a[l]}}h=n?n.apply(a[e],m):undefined;if(e)if(s&&s.exports!==r&&s.exports!==a[e])a[e]=s.exports;else if(h!==r||!E)a[e]=h}else e&&(a[e]=n)},e=t=s=function(e,t,n,a,f){if(typeof e=="string")return u[e]?u[e](t):w(o(e,t).f);if(!e.splice){l=e,l.deps&&s(l.deps,l.callback);if(!t)return;t.splice?(e=t,t=n,n=null):e=r}return t=t||function(){},typeof n=="function"&&(n=a,a=f),a?i(r,e,t,n):setTimeout(function(){i(r,e,t,n)},4),s},s.config=function(e){return s(e)},e._defined=a,n=function(e,t,n){t.splice||(n=t,t=[]),!v(a,e)&&!v(f,e)&&(f[e]=[e,t,n])},n.amd={jQuery:!0}})(),n("../build/libs/almond.js",function(){}),n("util/CommonTools",[],function(){return{_navigator:navigator,extend:function(e,t){for(var n in t)t.hasOwnProperty(n)&&(typeof t[n]=="object"?e[n]=this.extend({},t[n]):e[n]=t[n]);return e},addEvent:function(e,t,n){!/msie/i.test(this._navigator.userAgent)&&!/trident/i.test(this._navigator.userAgent)?e.addEventListener(t,n,!1):e.attachEvent("on"+t,n)}}}),n("util/Log",[],function(){window.console||(window.console={log:function(){}});var e=function(t){return function(n,r,i){i||(i="debug"),e.Config.isLogToBeOutput(t,n,i)&&console.log("["+t+"."+n+"] "+r)}};return e.LOG_ERROR="error",e.LOG_WARN="warn",e.LOG_DEBUG="debug",e.LOG_INFO="info",e.Config={isLoggingToConsoleEnabled:!1,defaultValues:1,loggingLevels:{error:1,warn:1,debug:1,info:1},classLogging:{},methodLogging:{},_isLevelEnabled:function(e){return this.defaultValues===1&&(this.loggingLevels[e]===1||this.loggingLevels[e]===undefined)||this.defaultValues===0&&this.loggingLevels[e]===1?!0:!1},setEnableLogging:function(e){this.isLoggingToConsoleEnabled=e},setDefaultValues:function(e){this.defaultValues=e},setLoggingLevels:function(e){this.loggingLevels=e},setClassLogging:function(e){this.classLogging=e},setMethodLogging:function(e){this.methodLogging=e},configure:function(e){var t,n=null;for(n in e)if(e.hasOwnProperty(n)){t=this["set"+n.substr(0,1).toUpperCase()+n.substr(1)];if(!t)throw"Log.Config configure - no setter method for attribute "+n;t.call(this,e[n])}},isLogToBeOutput:function(e,t,n){if(this.isLoggingToConsoleEnabled&&this._isLevelEnabled(n))if(this.defaultValues===0){if(this.classLogging[e]===1&&this.methodLogging[t]!==0||this.methodLogging[t]===1)return!0}else if((this.classLogging[e]===undefined||this.classLogging[e]===1)&&(this.methodLogging[t]===undefined||this.methodLogging[t]===1))return!0;return!1}},e}),n("util/Observable",["util/Log"],function(e){var t={_log:new e("Observable"),addEventListener:function(e,t){this._log("addEventListener","Adding listener for "+e+" event"),this._eventLookup||(this._eventLookup={}),this._eventLookup[e]||(this._eventLookup[e]=[]),this._eventLookup[e].push(t)},removeEventListener:function(e,t){this._log("removeEventListener","Removing listener for "+e+" event"),this._eventLookup&&this._eventLookup[e]&&(this._eventLookup[e]=this._eventLookup[e].filter(function(e){return e!==t}))},_fireEvent:function(e,t){this._log("_fireEvent","Firing "+e+" event"),this._eventLookup&&this._eventLookup[e]&&this._eventLookup[e].forEach(function(e){t&&t.length&&typeof t!="string"?e.apply(null,t):e(t)})}};return t}),n("util/AsyncAgent",["util/CommonTools","util/Observable"],function(e,t){var n={_translateParameters:function(e){var t=0,n="cb",r=[],i=this;return this._cbIndex||this._cbIndex===0?this._cbIndex++:this._cbIndex=0,n+=this._cbIndex,this._callbackLookup||(this._callbackLookup={}),this._callbackLookup[n]=[],e.forEach(function(e){typeof e=="function"?(i._callbackLookup[n].push(e),r.push(n+t)):r.push(e)}),r},_resolveCallback:function(e){var t,n,r,i;for(t=0;t<e.length;t++)n=e[t].ref,r=n.substr(0,n.length-1),i=n.substr(n.length-1,1),this._callbackLookup&&this._callbackLookup[r]&&this._callbackLookup[r][i]&&this._callbackLookup[r][i].apply(null,e[t].params),this._callbackLookup[r]=null,delete this._callbackLookup[r]},_triggerEvent:function(e){var t;for(t=0;t<e.length;t++)this._fireEvent(e[t].ref,e[t].params)},_updateProperties:function(e){var t,n;if(e)for(n=0;n<e.length;n++)if(e[n]&&e[n].params&&e[n].params[0]){t=e[n].params[0];for(var r in t)this[r]=t[r]}}};return e.extend(n,t),n}),n("MessageBroker",["util/Log"],function(e){return{_log:new e("MessageBroker"),_targets:{},_pluginInstance:null,_pluginType:null,_callOperationOnTarget:function(e,t,n){this._targets[e][t].call(this._targets[e],n[e])},_processMessageForOperation:function(e,t){var n=e[t],r;if(n)for(r in n)n.hasOwnProperty(r)&&this._targets[r]&&this._targets[r][t]&&this._callOperationOnTarget(r,t,n)},setPluginInstance:function(e){var t=this;this._pluginInstance=e,this._pluginInstance.addEventListener("message",function(e){t.recieveMessage(e.data)},!0)},registerTarget:function(e){this._log("registerTarget","Registering target with name "+e.getName()),this._targets[e.getName()]=e},createMessage:function(e,t,n,r){var i=t._translateParameters(r);return this._log("createMessage","Creating message with params target: "+e+", sender: "+t.getName()+", operation: "+n+", parameters: "+i),{target:e,sender:t.getName(),op:n,params:i}},sendMessage:function(e,t){this._log("sendMessage","Sending message "+e);if(!!t)return this._pluginInstance.postMessageAndAwaitResponse(e);this._pluginInstance.postMessage(e)},recieveMessage:function(e){this._log("recieveMessage","Message received "+e);var t;e._updateProperties&&this._processMessageForOperation(e,"_updateProperties"),delete e._updateProperties;for(t in e)e.hasOwnProperty(t)&&this._processMessageForOperation(e,t)}}}),n("DRMAgent",["util/CommonTools","util/AsyncAgent","MessageBroker"],function(e,t,n){function r(){this._messageBroker=n,this._messageBroker.registerTarget(this),this._deviceId="",this._deviceUniqueId="",this._state=this.TDRMState.STATE_INITIALIZATION_REQUIRED,this._initializationPayloadForServer="",this._serverPrivateData="",this._lastCommunicationStatus=this.TDRMCommuncationStatus.COMMUNICATION_UNKNOWN,this._licenseImportationState=this.TDRMLicenseImportationState.LICENSE_IMPORTATION_UNSTARTED,this._lastStorageError=this.TDRMStorageError.PAK_STORAGE_NO_ERROR,this._prefetchLicensesState=this.TDRMLicensePrefetchingState.LICENSE_PREFETCHING_UNSTARTED,this._sessions=[]}return r.prototype.initialize=function(e){var t=this._messageBroker.createMessage("drmAgent",this,"initialize",[e]);this._messageBroker.sendMessage(t)},r.prototype.silentInitialize=function(e,t,n){var r=this._messageBroker.createMessage("drmAgent",this,"silentInitialize",[e,t,n]);this._messageBroker.sendMessage(r)},r.prototype.setEntitlement=function(e,t,n){var r=this._messageBroker.createMessage("drmAgent",this,"setEntitlement",[e,t,n]);this._messageBroker.sendMessage(r)},r.prototype.requestEntitlement=function(e,t,n,r){var i=typeof e=="string"?JSON.parse(e):e,s=[i,t,n];r&&s.push(r);var o=this._messageBroker.createMessage("drmAgent",this,"requestEntitlement",s);this._messageBroker.sendMessage(o)},r.prototype.importLicenses=function(e){var t=this._messageBroker.createMessage("drmAgent",this,"importLicenses",[e]);this._messageBroker.sendMessage(t)},r.prototype.getPrefetchLicensesPayloadForServer=function(){var e=this._messageBroker.createMessage("drmAgent",this,"getPrefetchLicensesPayloadForServer",[]);this._messageBroker.sendMessage(e)},r.prototype.generateListOfStoredDrmEntitlements=function(e,t,n,r){var i=this._messageBroker.createMessage("drmAgent",this,"generateListOfStoredDrmEntitlements",[e,t,n,r]);this._messageBroker.sendMessage(i)},r.prototype.eraseStoredEntitlements=function(e){var t=this._messageBroker.createMessage("drmAgent",this,"eraseStoredEntitlements",[e]);this._messageBroker.sendMessage(t)},r.prototype.prefetchLicenses=function(e,t,n,r){var i=this._messageBroker.createMessage("drmAgent",this,"prefetchLicenses",[e,t,n,r]);this._messageBroker.sendMessage(i)},r.prototype.getDrmSessions=function(){return this._sessions},r.prototype.getName=function(){return"drmAgent"},Object.defineProperty(r.prototype,"deviceId",{get:function(){return this._deviceId},enumerable:!0,configurable:!1}),Object.defineProperty(r.prototype,"deviceUniqueId",{get:function(){return this._deviceUniqueId},enumerable:!0,configurable:!1}),Object.defineProperty(r.prototype,"state",{get:function(){return this._state},enumerable:!0,configurable:!1}),Object.defineProperty(r.prototype,"initializationPayloadForServer",{get:function(){return this._initializationPayloadForServer},enumerable:!0,configurable:!1}),Object.defineProperty(r.prototype,"serverPrivateData",{get:function(){return this._serverPrivateData},enumerable:!0,configurable:!1}),Object.defineProperty(r.prototype,"lastCommunicationStatus",{get:function(){return this._lastCommunicationStatus},enumerable:!0,configurable:!1}),Object.defineProperty(r.prototype,"licenseImportationState",{get:function(){return this._licenseImportationState},enumerable:!0,configurable:!1}),Object.defineProperty(r.prototype,"lastStorageError",{get:function(){return this._lastStorageError},enumerable:!0,configurable:!1}),Object.defineProperty(r.prototype,"prefetchLicensesState",{get:function(){return this._prefetchLicensesState},enumerable:!0,configurable:!1}),r.prototype.TDRMState={STATE_READY:0,STATE_INITIALIZATION_REQUIRED:100,STATE_FATAL_ERROR:200,STATE_FATAL_ERROR_OPERATOR:201},r.prototype.TDRMAccess={ACCESS_GRANTED:0,ACCESS_DENIED:100,ACCESS_DENIED_EXPIRED_ENTITLEMENT:101,ACCESS_DENIED_INVALID_ENTITLEMENT:102,ACCESS_DENIED_RETRIEVING_LICENSE:103},r.prototype.TDRMSessionStatus={SESSION_ENTITLEMENT_MISSING:1,SESSION_RETRIEVING_LICENSE:5,SESSION_OPENED:10,SESSION_FAILED:100,SESSION_FAILED_NOT_ALLOWED:102},r.prototype.TDRMEntitlementState={ENTITLEMENT_MISSING:0,ENTITLEMENT_READY:1},r.prototype.TDRMLicenseImportationState={LICENSE_IMPORTATION_UNSTARTED:0,LICENSE_IMPORTATION_IN_PROGRESS:1,LICENSE_IMPORTATION_DONE:2},r.prototype.TDRMStorageError={PAK_STORAGE_NO_ERROR:0,PAK_STORAGE_ERROR_DATABASE_OR_DISK_FULL:1,PAK_STORAGE_NOT_ALLOWED:2,PAK_STORAGE_ERROR_DB_ERROR:3},r.prototype.TDRMLicensePrefetchingState={LICENSE_PREFETCHING_UNSTARTED:0,LICENSE_PREFETCHING_IN_PROGRESS:1,LICENSE_PREFETCHING_DONE:2,LICENSE_PREFETCHING_ERROR_COMMUNICATION_FAILED:100},r.prototype.TDRMCommuncationStatus={COMMUNICATION_OK:0,COMMUNICATION_UNKNOWN:100,COMMUNICATION_PLAYER_UPGRADE_REQUIRED:101,COMMUNICATION_ERROR_REQUEST_DENIED:200,COMMUNICATION_ERROR_URL:201,COMMUNICATION_ERROR_CONNECT:202,COMMUNICATION_ERROR_PROXY:203,COMMUNICATION_ERROR_HOST:204,COMMUNICATION_ERROR_HTTP:205,COMMUNICATION_ERROR_SEND:206,COMMUNICATION_ERROR_RECEIVE:207,COMMUNICATION_ERROR_TIMEOUT:208,COMMUNICATION_ERROR_INTERNAL:209,COMMUNICATION_STATUS_WHITEBOX_CRYPTO_ERROR:210,COMMUNICATION_STATUS_UNKNOWN_OPERATOR:211,COMMUNICATION_STATUS_REQUEST_FORMAT_ERROR:212,COMMUNICATION_STATUS_CHALLENGE_FORMAT_ERROR:213,COMMUNICATION_STATUS_UNDEFINED_DEVICE:214,COMMUNICATION_STATUS_INVALID_CONTENT_ID:215,COMMUNICATION_STATUS_INVALID_KEY_ID:216,COMMUNICATION_STATUS_PORTAL_ERROR:217},e.extend(r.prototype,t),r}),n("UserAgent",["util/CommonTools","util/AsyncAgent","MessageBroker"],function(e,t,n){function r(){var e=this;this._messageBroker=n,this._messageBroker.registerTarget(this),this._fullscreen=!1,this._platform="NaCl",this._version="NMP.1.4.2",this._interfaceVersion="",this._cpuCores=null,this._density=null,this._cpuFrequency=null,this._os=null,window.parent.document.addEventListener("nmp.fetchDeviceInformation",function(t){var n=t&&t.detail?t.detail:{};for(var r in n)n.hasOwnProperty(r)&&(e[r]=n[r])})}return Object.defineProperty(r.prototype,"fullscreen",{get:function(){return this._fullscreen},set:function(){},enumerable:!0,configurable:!1}),Object.defineProperty(r.prototype,"platform",{get:function(){return this._platform},enumerable:!0,configurable:!1}),Object.defineProperty(r.prototype,"version",{get:function(){return this._version},enumerable:!0,configurable:!1}),Object.defineProperty(r.prototype,"interfaceVersion",{get:function(){return this._interfaceVersion},enumerable:!0,configurable:!1}),Object.defineProperty(r.prototype,"uninstallUrl",{get:function(){return this._uninstallUrl},set:function(e){this._uninstallUrl=e,this._log("uninstallUrl","Setting uninstallUrl to "+e);var t=document.createEvent("CustomEvent");t.initCustomEvent("nmp-extension-message",!0,!0,{action:e}),window.parent.document.dispatchEvent(t)},enumerable:!0,configurable:!1}),Object.defineProperty(r.prototype,"deviceInformation",{get:function(){return{device:{OS:{type:this._os,version:null,runtime:"NaCl"},CPU:{cores:this._cpuCores,frequency:this._cpuFrequency},GPU:{cores:null,frequency:null,model:null},hardware:{type:"Desktop",model:null,manufacturer:null},screen:{width:screen.width,height:screen.height,density:this._density}},securePlayer:{DRMs:["PRM"],streamings:["HLS"],codecs:["H264","AAC"]}}},enumerable:!0,configurable:!1}),r.prototype.getName=function(){return"userAgent"},e.extend(r.prototype,t),r}),n("VideoAgent",["util/CommonTools","util/AsyncAgent","MessageBroker","util/Log"],function(e,t,n,r){function i(e){return e.indexOf("%")===-1&&e.toLowerCase().indexOf("px")===-1&&(e+="px"),e}function o(e){return{_timeRanges:e,start:function(e){return this._timeRanges&&this._timeRanges[e]?this._timeRanges[e].start:0},end:function(e){return this._timeRanges&&this._timeRanges[e]?this._timeRanges[e].end:0},length:e.length||0}}var s=function(){var e=this;this._log=new r("VideoAgent"),this._autoplay=!0,this._controls=!0,this._muted=!1,this._volume=1,this._resetProperties(),this._isPendingSetSource=!1,this._queuedSrc=null,this._messageBroker=n,this._messageBroker.registerTarget(this),this.MAXIMUM_SEEK_BACK_BOUNDARY=2147483647,this.addEventListener("error",function(){e._setPendingSetSource(!1)})};return s.prototype=Object.create(HTMLElement.prototype),e.extend(s.prototype,t),s.prototype._resetProperties=function(){this._src="",this._currentTime=0,this._paused=!0,this._duration=0,this._ended=!1,this._seeking=!1,this._readyState=this.HAVE_NOTHING,this._networkState=this.NETWORK_EMPTY,this._seekable=o([]),this._error=null,this._videoWidth=0,this._videoHeight=0,this._maximumSeekBack=0,this._disableSeek=!1},s.prototype._setPendingSetSource=function(e){this._isPendingSetSource=e,!this._isPendingSetSource&&this._queuedSrc&&(this.src=this._queuedSrc,this._queuedSrc=null)},Object.defineProperty(s.prototype,"src",{get:function(){return this._src},set:function(e){this._log("src","Setting src to "+e);if(!this._isPendingSetSource){this._resetProperties(),this._queuedSrc=null;var t=this._messageBroker.createMessage("videoAgent",this,"setSrc",[e]);this._messageBroker.sendMessage(t),this._setPendingSetSource(!0)}else this._queuedSrc=e},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"autoplay",{get:function(){return this._autoplay},set:function(e){this._log("autoplay","Setting autoplay to "+e),this._autoplay=e;var t=this._messageBroker.createMessage("videoAgent",this,"setAutoplay",[this._autoplay]);this._messageBroker.sendMessage(t)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"currentSrc",{get:function(){return this._src}}),Object.defineProperty(s.prototype,"currentTime",{get:function(){return this._currentTime},set:function(e){this._log("currentTime","Setting currentTime to "+e);if(this._duration!==4294967296||!this._disableSeek){var t=this._messageBroker.createMessage("videoAgent",this,"setCurrentTime",[e]);this._messageBroker.sendMessage(t)}},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"duration",{get:function(){return this._duration},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"paused",{get:function(){return this._paused},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"ended",{get:function(){return this._ended},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"seeking",{get:function(){return this._seeking},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"seekable",{get:function(){return this._seekable},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"readyState",{get:function(){return this._readyState},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"HAVE_NOTHING",{get:function(){return 0},enumerable:!0,configurable:!1}),Object.defineProperty(s.prototype,"HAVE_METADATA",{get:function(){return 1},enumerable:!0,configurable:!1}),Object.defineProperty(s.prototype,"HAVE_CURRENT_DATA",{get:function(){return 2},enumerable:!0,configurable:!1}),Object.defineProperty(s.prototype,"HAVE_FUTURE_DATA",{get:function(){return 3},enumerable:!0,configurable:!1}),Object.defineProperty(s.prototype,"HAVE_ENOUGH_DATA",{get:function(){return 4},enumerable:!0,configurable:!1}),Object.defineProperty(s.prototype,"networkState",{get:function(){return this._networkState},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"NETWORK_EMPTY",{get:function(){return 0},enumerable:!0,configurable:!1}),Object.defineProperty(s.prototype,"NETWORK_IDLE",{get:function(){return 1},enumerable:!0,configurable:!1}),Object.defineProperty(s.prototype,"NETWORK_LOADING",{get:function(){return 2},enumerable:!0,configurable:!1}),Object.defineProperty(s.prototype,"NETWORK_NO_SOURCE",{get:function(){return 3},enumerable:!0,configurable:!1}),Object.defineProperty(s.prototype,"error",{get:function(){return this._error?{MEDIA_ERR_ABORTED:1,MEDIA_ERR_NETWORK:2,MEDIA_ERR_DECODE:3,MEDIA_ERR_SRC_NOT_SUPPORTED:4,code:this._error}:null},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"controls",{get:function(){return this._controls},set:function(e){this._log("controls","Setting controls to "+e),this._controls=e},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"volume",{get:function(){return this._volume},set:function(e){this._log("volume","Setting volume to "+e),e=parseFloat(e);if((e||e===0)&&e>=0&&e<=1){var t=this._messageBroker.createMessage("videoAgent",this,"setVolume",[e]);this._messageBroker.sendMessage(t)}},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"muted",{get:function(){return this._muted},set:function(e){this._log("muted","Setting muted to "+e);var t=this._messageBroker.createMessage("videoAgent",this,"setMuted",[e]);this._messageBroker.sendMessage(t)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"videoWidth",{get:function(){return this._videoWidth},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"videoHeight",{get:function(){return this._videoHeight},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"width",{get:function(){return parseInt(window.getComputedStyle(this,null).getPropertyValue("width"),10)},set:function(e){e+="",this.setAttribute("width",e)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"height",{get:function(){return parseInt(window.getComputedStyle(this,null).getPropertyValue("height"),10)},set:function(e){e+="",this.setAttribute("height",e)},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"maximumSeekBack",{get:function(){return this._maximumSeekBack},set:function(e){this._log("maximumSeekBack","Setting maximumSeekBack to "+e),e=parseInt(e,10);if((e||e===0)&&e<=this.MAXIMUM_SEEK_BACK_BOUNDARY){this._maximumSeekBack=e;var t=this._messageBroker.createMessage("videoAgent",this,"setMaximumSeekBack",[this._maximumSeekBack]);this._messageBroker.sendMessage(t)}},enumerable:!0,configurable:!0}),Object.defineProperty(s.prototype,"disableSeek",{get:function(){return this._disableSeek},set:function(e){this._log("disableSeek","Setting disableSeek to "+e),this._disableSeek=e===!0||e==="true"?!0:!1;var t=this._messageBroker.createMessage("videoAgent",this,"setDisableSeek",[this._disableSeek]);this._messageBroker.sendMessage(t)},enumerable:!0,configurable:!0}),s.prototype.pause=function(){this._log("pause","");var e=this._messageBroker.createMessage("videoAgent",this,"pause",[]);this._messageBroker.sendMessage(e)},s.prototype.play=function(){this._log("play","");var e=this._messageBroker.createMessage("videoAgent",this,"play",[]);this._messageBroker.sendMessage(e)},s.prototype.load=function(){this._log("load","");var e=this._messageBroker.createMessage("videoAgent",this,"load",[]);this._messageBroker.sendMessage(e)},s.prototype.stop=function(){this._log("stop","");var e=this._messageBroker.createMessage("videoAgent",this,"stop",[]);this._messageBroker.sendMessage(e)},s.prototype._updateProperties=function(e){var n,r;if(e){for(r=0;r<e.length;r++)e[r]&&e[r].params&&e[r].params[0]&&(n=e[r].params[0],n._seekable&&(this._seekable=o(n._seekable),delete e[r].params[0]._seekable));t._updateProperties.call(this,e)}},s.prototype.getName=function(){return"videoAgent"},document.registerElement&&(s.prototype.attributeChangedCallback=function(e,t,n){if(e==="width"||e==="height")n+="",this.style[e]=i(n);e==="src"&&(this.src=n)},s.prototype.createdCallback=function(){var e=this;s.call(this);var t=this.getAttribute("width");t&&(this.style.width=i(t));var n=this.getAttribute("height");n&&(this.style.height=i(n));var r=this.createShadowRoot(),o=document.createElement("style");o.innerHTML=":host {background-color: black; display: block; margin:auto; padding: 0; position: relative; width: 427px; height: 240px}.white {color: white} .green{color: green} .blue{color: blue} .cyan{color: cyan} .red{color: red} .yellow{color: yellow} .magenta{color: magenta} .black{color: black}.bg_white {background-color: white} .bg_green{background-color: green} .bg_blue{background-color: blue} .bg_cyan{background-color: cyan} .bg_red{background-color: red}.bg_yellow{background-color: yellow} .bg_magenta{background-color: magenta}.transparent{opacity: 0} .semi-transparent{opacity: 0.5} .opaque{opacity: 1}.underline{text-decoration: underline} .italics{font-style: italic} .blink{-webkit-animation: blink 1s steps(1, start) infinite}@-webkit-keyframes blink {0% { opacity: 1.0; } 50% { opacity: 0.0; } 100% { opacity: 1.0; }}.mono_serif {font-family:'Courier New', monospace, serif;} .prop_serif{font-family:'Times Roman', serif;} .mono_sans{font-family:'Arial Monospaced', monospace, sans-serif;}.prop_sans{font-family:'Century Gothic', sans-serif;} .casual{ font-family:'Lucinda Casual', 'Dom Casual';} .cursive{font-family: cursive;} .small_caps{font-variant: small-caps;}.outline_white {text-shadow: -1px -1px 0 white, 1px -1px 0 white, -1px 1px 0 white, 1px 1px 0 white;} .outline_green{text-shadow: -1px -1px 0 green, 1px -1px 0 green, -1px 1px 0 green, 1px 1px 0 green;} .outline_blue{text-shadow: -1px -1px 0 blue, 1px -1px 0 blue, -1px 1px 0 blue, 1px 1px 0 blue;} .outline_cyan{text-shadow: -1px -1px 0 cyan, 1px -1px 0 cyan, -1px 1px 0 cyan, 1px 1px 0 cyan;} .outline_red{text-shadow: -1px -1px 0 red, 1px -1px 0 red, -1px 1px 0 red, 1px 1px 0 red;} .outline_yellow{text-shadow: -1px -1px 0 yellow, 1px -1px 0 yellow, -1px 1px 0 yellow, 1px 1px 0 yellow;} .outline_magenta{text-shadow: -1px -1px 0 magenta, 1px -1px 0 magenta, -1px 1px 0 magenta, 1px 1px 0 magenta;} .outline_black{text-shadow: -1px -1px 0 black, 1px -1px 0 black, -1px 1px 0 black, 1px 1px 0 black;}",r.appendChild(o);var u=document.createElement("embed");u.style.position="absolute",u.setAttribute("id","__nmpcbrowserplugin"),u.style.left="0px",u.style.top="0px",u.style.width="100%",u.style.height="100%",u.setAttribute("data-nmp-resourcepath",this.getAttribute("data-nmp-resourcepath")||"testData/"),u.setAttribute("type",this.getAttribute("type")||"application/x-nacl"),u.setAttribute("src",this.getAttribute("data-nmp-src")),u.setAttribute("onload","__NMPPluginLoaded(this)"),this._subtitleElem=document.createElement("div"),this._subtitleElem.style.position="absolute",this._subtitleElem.style.webkitTransform="translate3d(0px, 0px, 0px)",this._subtitleElem.style.width="100%",this._subtitleElem.style.height="100%",this._subtitleElem.style.overflow="hidden",this._subtitleElem.style.tabSize=4,this._subtitleElem.style.lineHeight="130%",this._subtitleElem.style.color="rgb(255,255,255)",navigator.webkitPersistentStorage.requestQuota(67108864,function(t){t>0?(r.appendChild(u),r.appendChild(e._subtitleElem)):e.onerror&&typeof e.onerror=="function"&&e.onerror()},function(){e.onerror&&typeof e.onerror=="function"&&e.onerror()})},document.registerElement("nmp-video",{prototype:s.prototype})),s}),n("NetworkAgent",["util/CommonTools","util/AsyncAgent","MessageBroker"],function(e,t,n){function r(){this._messageBroker=n,this._messageBroker.registerTarget(this),this._error=null,this._availableBitrates=[],this._selectedBitrate=null,this._contentServerUrl=null,this._contentServerFinalUrl=null,this._contentServerFinalIPAddress=null,this._downloadBitrate=0,this._downloadBitrateAverage=0,this._bytesDownloaded=0,this._httpErrorCode=null,this._httpErrorMessage=null}return r.prototype.getName=function(){return"networkAgent"},Object.defineProperty(r.prototype,"error",{get:function(){return this._error},enumerable:!0,configurable:!1}),Object.defineProperty(r.prototype,"adaptiveStreaming",{get:function(){return{availableBitrates:this._availableBitrates,selectedBitrate:this._selectedBitrate?this._selectedBitrate:null}},enumerable:!0,configurable:!1}),Object.defineProperty(r.prototype,"contentServer",{get:function(){return{url:this._contentServerUrl?this._contentServerUrl:null,finalUrl:this._contentServerFinalUrl?this._contentServerFinalUrl:null,finalIpAddress:this._contentServerFinalIPAddress?this._contentServerFinalIPAddress:null}},enumerable:!0,configurable:!1}),Object.defineProperty(r.prototype,"usage",{get:function(){var e=this._messageBroker.createMessage("networkAgent",this,"getNetworkUsage",[]);return this._messageBroker.sendMessage(e,!0)},enumerable:!0,configurable:!1}),Object.defineProperty(r.prototype,"httpErrorCode",{get:function(){return this._httpErrorCode=this._httpErrorCode?this._httpErrorCode:null,this._httpErrorCode},enumerable:!0,configurable:!1}),Object.defineProperty(r.prototype,"httpErrorMessage",{get:function(){return this._httpErrorMessage=this._httpErrorMessage?this._httpErrorMessage:null,this._httpErrorMessage},enumerable:!0,configurable:!1}),r.prototype.TNetworkError={NETWORK_HOST_CONNECTION_REFUSED:1,NETWORK_HOST_CONNECTION_CLOSED:2,NETWORK_HOST_NOT_FOUND:3,NETWORK_HOST_TIMEOUT:4,NETWORK_PROXY_CONNECTION_REFUSED:101,NETWORK_PROXY_CONNECTION_CLOSED:102,NETWORK_PROXY_NOT_FOUND:103,NETWORK_PROXY_TIMEOUT:104,NETWORK_PROXY_AUTHENTICATION_REQUIRED:105,NETWORK_CONTENT_HTTP_ERROR:400,NETWORK_UNKNOWN_ERROR:1001},e.extend(r.prototype,t),r}),n("libs/fittext",[],function(){var e=function(e,t){return window.getComputedStyle?getComputedStyle(e).getPropertyValue(t):e.currentStyle[t]},t=function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,n)},n=function(e,t){for(key in t)t.hasOwnProperty(key)&&(e[key]=t[key]);return e};window.fitText=function(e,r,i){var s=n({minFontSize:-1/0,maxFontSize:1/0},i),o=function(e){var n=r||1,i=function(){e.style.fontSize=Math.max(Math.min(e.clientWidth/(n*10),parseFloat(s.maxFontSize)),parseFloat(s.minFontSize))+"px"};i(),t(window,"resize",i)};if(e.length)for(var u=0;u<e.length;u++)o(e[u]);else o(e);return e}}),n("util/Timer",[],function(){function e(e){this._timeRemaining=0,this._expiredCallback=e,this._startTime=0,this._timeout=null}return e.prototype.setDuration=function(e,t){this._timeRemaining=e,t&&(this.cancel(),this.start())},e.prototype.start=function(){var e=this;this._timeout||(this._startTime=new Date,this._timeout=window.setTimeout(function(){e._expiredCallback()},this._timeRemaining))},e.prototype.stop=function(){this.cancel(),this._timeRemaining-=new Date-this._startTime},e.prototype.cancel=function(){this._timeout&&(window.clearTimeout(this._timeout),this._timeout=null)},e}),n("WebVTTSubtitleRenderer",["libs/fittext","util/Timer"],function(e,t){function n(){var e=this;this._vttCues=[],this._mainSubtitleDiv=null,this._displayedVTTCue=null,this._textSpanBGColor=null,this._textSpanBGOpacity=null,this._fontColor=null,this._fontOpacity=null,this._edgeAttribute=null,this._edgeRGB=null,this._containerStyles=[],this._FITTEXT_OFFSET=2.1,this.fittextRatio=.02,this._MAX_FONTSIZE=200,this._fittextCompressRate=null,this._createFontStyleLookup(),this._styleElement=null,this._divHeight=0,this._divWidth=0,this._SAFE_MARGIN_PERCENT=10,this._DEFAULT_LINE_PERCENTAGE=80,this._isSubtitlesActivated=!1,this._clearScreenTimer=new t(function(){e.clearScreen()}),this._regions={},this._videoWidth=0,this._videoHeight=0}return n.prototype.onPause=function(){this._clearScreenTimer&&this._clearScreenTimer.stop();for(var e in this._regions)this._regions.hasOwnProperty(e)&&this._regions[e].container.style.display==="block"&&this._regions[e].timer.stop()},n.prototype.onPlay=function(){this._displayedVTTCue&&this._clearScreenTimer.start();for(var e in this._regions)this._regions.hasOwnProperty(e)&&this._regions[e].container.style.display==="block"&&this._regions[e].timer.start()},n.prototype._createFontStyleLookup=function(){this._fontStyleLookup={},this._fontStyleLookup[1]={className:".mono_serif",defaultFont:" monospace, serif"},this._fontStyleLookup[2]={className:".prop_serif",defaultFont:" serif"},this._fontStyleLookup[3]={className:".mono_sans",defaultFont:" monospace, sans-serif"},this._fontStyleLookup[4]={className:".prop_sans",defaultFont:" sans-serif"},this._fontStyleLookup[5]={className:".casual",defaultFont:""},this._fontStyleLookup[6]={className:".cursive",defaultFont:" cursive"},this._fontStyleLookup[7]={className:".small_caps",defaultFont:" small-caps"}},n.prototype._addBackground=function(e){var t,n,r,i,s=e.childNodes;for(var o=0;o<s.length;o++)n=s[o],r=this._textSpanBGColor!==null?this._textSpanBGColor:"0,0,0",i=this._textSpanBGOpacity!==null?this._textSpanBGOpacity:"1",n.textContent.trim()!=="\n"&&n.textContent.trim()!==""&&(n.nodeValue===null?n.style&&n.style.backgroundColor===""?n.className.indexOf("transparent")===-1?(r=this._getRGBColorForComputedStyle(window.getComputedStyle(n,null).getPropertyValue("background-color")),r=this._textSpanBGColor!==null?this._textSpanBGColor:r,n.style.backgroundColor="rgba("+r+","+i+")"):(t=document.createElement("span"),t.style.backgroundColor="rgba("+r+","+i+")",n.parentNode.insertBefore(t,n),t.appendChild(n)):(n.style.backgroundColor.indexOf("rgba")!==-1?(i=this._getOpacityForRGBAString(n.style.backgroundColor),r=this._getRGBValueForRGBAString(n.style.backgroundColor)):n.style.backgroundColor.indexOf("rgb")!==-1?(i=1,r=this._getRGBValueForString(n.style.backgroundColor,"rgb(")):(i=1,r=this._getRGBColorForComputedStyle(window.getComputedStyle(n,null).getPropertyValue("background-color"))),r=this._textSpanBGColor!==null?this._textSpanBGColor:r,i=this._textSpanBGOpacity!==null?this._textSpanBGOpacity:i,n.style.backgroundColor="rgba("+r+","+i+")"):(t=document.createElement("span"),t.style.backgroundColor="rgba("+r+","+i+")",t.innerHTML=n.nodeValue,n.parentNode.insertBefore(t,n),n.parentNode.removeChild(n)))},n.prototype._getRGBValueForRGBAString=function(e){var t=e.indexOf("rgba("),n=e.lastIndexOf(",");return e.substring(t+5,n)},n.prototype._getOpacityForRGBAString=function(e){var t=e.lastIndexOf(","),n=e.indexOf(")",t);return e.substring(t+1,n)},n.prototype._getRGBValueForString=function(e,t){var n=e.indexOf(t),r=e.indexOf(")",n);return e.substring(n+t.length,r)},n.prototype._applyNodeStyles=function(e){var t=e.getElementsByTagName("*"),n,r,i,s,o=1,u;t.length===0&&(t=[e]);for(var r=0;r<t.length;r++){i=null,n=t[r],u=n.className,this._applyNodeColorStyles(n),u.indexOf("bg_rgb(")>-1&&(i="rgb("+this._getRGBValueForString(u,"bg_rgb(")+")",n.style.backgroundColor=i);if(u.indexOf("bg_semi-transparent")>-1||u.indexOf("bg_transparent")>-1||u.indexOf("bg_opaque")>-1)i||(i=window.getComputedStyle(n,null).getPropertyValue("background-color")),u.indexOf("bg_semi-transparent")>-1?o=.5:u.indexOf("bg_transparent")>-1?o=0:o=1,i.indexOf("rgba")>-1&&(i=i.substr(0,i.lastIndexOf(",")).replace("rgba","rgb")+")"),n.style.backgroundColor=i.replace("rgb","rgba").replace(")",", "+o+")");if(u.indexOf("small")>-1||u.indexOf("large")>-1)s=parseInt(window.getComputedStyle(n,null).getPropertyValue("font-size"),10),u.indexOf("small")>-1?(n.style.verticalAlign="top",n.style.fontSize=s*.8+"px"):n.style.fontSize=s*1.2+"px";this._updateForEdgeStyles(n)}},n.prototype._getOpacityForComputedStyle=function(e){return e.indexOf("rgba(")!==-1?this._getOpacityForRGBAString(e):"1"},n.prototype._getRGBColorForComputedStyle=function(e){if(e.indexOf("rgba(")!==-1)return this._getRGBValueForRGBAString(e);if(e.indexOf("rgb(")!==-1)return this._getRGBValueForString(e,"rgb(")},n.prototype._applyNodeColorStyles=function(e){var t,n,r;this._fontColor&&(this._fontOpacity||this._fontOpacity===0)?e.style.color="rgba("+this._fontColor+","+this._fontOpacity+")":e.className.indexOf("color_rgb(")>-1&&(e.style.color="rgb("+this._getRGBValueForString(e.className,"color_rgb(")+")"),!this._fontColor&&(this._fontOpacity||this._fontOpacity===0)?(t=window.getComputedStyle(e,null).getPropertyValue("color"),r=this._getRGBColorForComputedStyle(t),e.style.color="rgba("+r+","+this._fontOpacity+")"):this._fontColor&&!this._fontOpacity&&this._fontOpacity!==0&&(t=window.getComputedStyle(e,null).getPropertyValue("color"),n=this._getOpacityForComputedStyle(t),e.style.color="rgba("+this._fontColor+","+n+")")},n.prototype._getTextShadowStyleForEdge=function(e,t){switch(e){case"NONE":return"";case"RAISED":return"-1px -1px 0px "+t;case"DEPRESSED":return"2px 1px 0px "+t;case"UNIFORM":return"-1px -1px 0px "+t+", 1px -1px 0px "+t+", -1px 1px 0px "+t+", 1px 1px 0px "+t;case"SHADOW":case"LEFT_SHADOW":return"-2px 2px 2px "+t;case"RIGHT_SHADOW":return"2px 2px 2px "+t;default:return""}},n.prototype._updateForEdgeStyles=function(e){var t=e.className,n="#000000";this._edgeAttribute||t.indexOf("raised")>-1||t.indexOf("depressed")>-1||t.indexOf("uniform")>-1||t.indexOf("left_drop_shadow")>-1||t.indexOf("right_drop_shadow")>-1?(this._edgeRGB?n="rgb("+this._edgeRGB+")":t.indexOf("outline_rgb")>-1?n="rgb("+this._getRGBValueForString(t,"outline_rgb(")+")":t.indexOf("outline_")>-1&&(n=t.substring(t.indexOf("outline_")+"outline_".length,t.length)),this._edgeAttribute?e.style.textShadow=this._getTextShadowStyleForEdge(this._edgeAttribute,n):t.indexOf("raised")>-1?e.style.textShadow=this._getTextShadowStyleForEdge("RAISED",n):t.indexOf("depressed")>-1?e.style.textShadow=this._getTextShadowStyleForEdge("DEPRESSED",n):t.indexOf("uniform")>-1?e.style.textShadow=this._getTextShadowStyleForEdge("UNIFORM",n):t.indexOf("left_drop_shadow")>-1?e.style.textShadow=this._getTextShadowStyleForEdge("LEFT_SHADOW",n):t.indexOf("right_drop_shadow")>-1&&(e.style.textShadow=this._getTextShadowStyleForEdge("RIGHT_SHADOW",n))):t.indexOf("outline_rgb")>-1?(n="rgb("+this._getRGBValueForString(t,"outline_rgb(")+")",e.style.textShadow="-1px -1px 0 "+n+", 1px -1px 0 "+n+", -1px 1px 0 "+n+", 1px 1px 0 "+n):e.style.textShadow=""},n.prototype._getAspectRatio=function(e,t){return e/t},n.prototype._repositionIfOverflowVideo=function(e){var t=this._mainSubtitleDiv.getBoundingClientRect(),n,r,i=t.top+t.height/100*90;e?(n=e.spanContainer.getBoundingClientRect(),r=e.container.getBoundingClientRect(),r.bottom>i&&(e.container.style.top=i-t.top-r.height+"px")):(r=this._container.getBoundingClientRect(),r.bottom>i&&(this._container.style.top=i-t.top-r.height+"px"))},n.prototype._positionMainDiv=function(){var e=this._getAspectRatio(this._videoWidth,this._videoHeight),t=this._outerSubtitleDiv.getBoundingClientRect(),n=this._getAspectRatio(t.width,t.height),r;n<e?(r=(t.height-t.width/e)/2,this._mainSubtitleDiv.style.top=r+"px",this._mainSubtitleDiv.style.left="0px",this._mainSubtitleDiv.style.width="100%",this._mainSubtitleDiv.style.height=t.height-r*2+"px"):n>e?(r=(t.width-t.height*e)/2,this._mainSubtitleDiv.style.top="0px",this._mainSubtitleDiv.style.left=r+"px",this._mainSubtitleDiv.style.width=t.width-r*2+"px",this._mainSubtitleDiv.style.height="100%"):(this._mainSubtitleDiv.style.height="100%",this._mainSubtitleDiv.style.width="100%",this._mainSubtitleDiv.style.top="0px",this._mainSubtitleDiv.style.left="0px")},n.prototype._showCue=function(e,t){var n=e.getCueAsHTML(),r,i,s=null;if(this._mainSubtitleDiv&&this._isSubtitlesActivated){e.lineAlign==="start"?i="left":e.lineAlign==="end"?i="right":e.lineAlign==="middle"?i="center":i=e.lineAlign||"left";if(e.region===null||e.region===undefined||e.region===-1){this._container=document.createElement("div"),this._textSpanContainer=document.createElement("div"),this._textSpan=document.createElement("span"),this._displayedVTTCue=e,this._textSpanContainer.style.position="relative",this._textSpanContainer.style.display="inline-block",this._textSpanContainer.style.width=e.size?e.size+"%":"100%";for(var r=0;r<this._containerStyles.length;r++)this._container.style[this._containerStyles[r].style]=this._containerStyles[r].value;this._container.style.textAlign=i,this._container.style.right="",this._container.style.left="",i==="right"?this._container.style.right=100-e.position+"%":this._container.style.left=e.position+"%",this._container.style.top=e.line==="auto"||e.line===-1?this._DEFAULT_LINE_PERCENTAGE+"%":e.line-1+"%",this._container.style.margin=0,this._container.style.padding=0,this._container.style.position="absolute",this._container.style.whiteSpace="pre-wrap",this._applyNodeColorStyles(this._container),this._textSpanContainer.appendChild(this._textSpan),this._container.appendChild(this._textSpanContainer),this._mainSubtitleDiv.appendChild(this._container);var o=this._textSpan;t&&this._clearScreenTimer.setDuration((e.endTime-e.startTime)*1e3,!0)}else{s=this._regions[e.region],s.vttCue=e,t&&(s.container.parentNode.appendChild(s.container),s.timer&&s.timer.cancel(),s.timer.setDuration((e.endTime-e.startTime)*1e3,!0));for(var r=0;r<this._containerStyles.length;r++)s.container.style[this._containerStyles[r].style]=this._containerStyles[r].value;s.container.style.top=s.regionObj.top+"%",s.spanContainer.style.top="0px",s.spanContainer.style.textAlign=i,s.container.style.display="block",o=s.span}o.innerHTML="",o.appendChild(n),this._applyNodeStyles(o),this._addBackground(o),fitText(this._mainSubtitleDiv,this._fittextCompressRate),this._container&&(this._container.style.padding="0.25em 0.5em"),this._repositionIfOverflowVideo(s)}},n.prototype.clearScreen=function(){this._container&&this._container.parentNode===this._mainSubtitleDiv&&this._mainSubtitleDiv.removeChild(this._container),this._displayedVTTCue=null,this._clearScreenTimer.cancel();for(var e in this._regions)this._regions.hasOwnProperty(e)&&this._hideRegion(e)},n.prototype._hideRegion=function(e){var t;if(this._regions[e]){t=this._regions[e];while(t.span.firstChild)t.span.removeChild(t.span.firstChild);t.timer&&t.timer.cancel(),this._regions[e].container.style.display="none"}},n.prototype.setMainSubtitleDiv=function(e){this._outerSubtitleDiv=e,this._styleElement=document.createElement("style"),this._outerSubtitleDiv&&(this._mainSubtitleDiv=document.createElement("div"),this._mainSubtitleDiv.style.position="absolute",this._mainSubtitleDiv.style.lineHeight="initial",this._mainSubtitleDiv.style.width="100%",this._mainSubtitleDiv.style.height="100%",this._mainSubtitleDiv.style.overflow="hidden",this._mainSubtitleDiv.style.tabSize=4,this._mainSubtitleDiv.appendChild(this._styleElement),this._outerSubtitleDiv.appendChild(this._mainSubtitleDiv),this._divHeight=this._outerSubtitleDiv.clientHeight,this._divWidth=this._outerSubtitleDiv.clientWidth)},n.prototype._webVTTJsonToVTTCue=function(e){var t=new VTTCue(e.startTime,e.endTime,e.text),n=e.position;return n||(n=this._SAFE_MARGIN_PERCENT),t.lineAlign=e.align,t.size=e.size,t.position=n,t.line=Math.ceil(e.line),t.region=e.regionId,t},n.prototype._createRegion=function(e){var n,r,i,s=this;if(this._mainSubtitleDiv){this._regions[e.id]&&this._regions[e.id].container.parentNode===this._mainSubtitleDiv&&this._mainSubtitleDiv.removeChild(this._regions[e.id].container),n=document.createElement("div"),r=document.createElement("div"),i=document.createElement("span"),r.style.position="relative",r.style.display="inline-block";for(var o=0;o<this._containerStyles.length;o++)n.style[this._containerStyles[o].style]=this._containerStyles[o].value;n.style.margin=0,n.style.width=e.width+"%",n.style.padding=0,n.style.position="absolute",n.style.whiteSpace="pre-wrap",r.style.backgroundColor=e.color,n.style.zIndex=e.layer,n.style.left=e.left+"%",r.style.height=e.height+"%",n.style.top=e.top+"%",n.style.display="none",n.style.right=this._SAFE_MARGIN_PERCENT+"%",n.style.textAlign="left",r.appendChild(i),n.appendChild(r),this._mainSubtitleDiv.appendChild(n),this._regions[e.id]={regionObj:e,container:n,spanContainer:r,span:i,timer:new t(function(){s._hideRegion(e.id)})}}},n.prototype.onWebVTTSubtitleChanged=function(e,t){t&&this._createRegion(t),e&&(e.size=e.size>100?100:e.size,e.regionId===null||e.regionId===undefined||e.regionId===-1?this.clearScreen():this._hideRegion(e.regionId),e.text&&e!==""&&this._showCue(this._webVTTJsonToVTTCue(e),!0))},n.prototype._didDivChangeSize=function(){return this._mainSubtitleDiv&&this._divHeight!==this._outerSubtitleDiv.clientHeight||this._divWidth!==this._outerSubtitleDiv.clientWidth?!0:!1},n.prototype._clearAllRegions=function(){for(var e in this._regions)this._regions.hasOwnProperty(e)&&this._regions[e].container.parentNode===this._mainSubtitleDiv&&this._mainSubtitleDiv.removeChild(this._regions[e].container);this._regions={}},n.prototype._subtitlesActivated=function(){this._isSubtitlesActivated=!0,this.clearScreen(),this._clearAllRegions(),this._vttCues=[]},n.prototype._subtitlesDeactivated=function(){this._isSubtitlesActivated=!1,this.clearScreen(),this._clearAllRegions(),this._vttCues=[]},n.prototype._redraw=function(){var e=this._displayedVTTCue;e&&(this.clearScreen(),this._showCue(e,!1));for(var t in this._regions)this._regions.hasOwnProperty(t)&&this._regions[t].container.style.display==="block"&&this._showCue(this._regions[t].vttCue,!1)},n.prototype.onViewDidChange=function(){this._mainSubtitleDiv&&this._didDivChangeSize()&&(this._divHeight=this._outerSubtitleDiv.clientHeight,this._divWidth=this._outerSubtitleDiv.clientWidth,this._positionMainDiv(),this._redraw())},n.prototype._didVideoAspectChange=function(e,t){return this._videoWidth&&this._videoHeight?this._getAspectRatio(e,t)!==this._getAspectRatio(this._videoWidth,this._videoHeight):!0},n.prototype.onVideoSizeChanged=function(e,t){this._mainSubtitleDiv&&this._didVideoAspectChange(e,t)&&(this._videoWidth=e,this._videoHeight=t,this._positionMainDiv(),this._redraw())},n.prototype.onCCSettingsChanged=function(e){var t="",n,r="";this._containerStyles=[{style:"backgroundColor",value:e.captionWindowColor}],this._textSpanBGColor=e.captionBackgroundColor,this._textSpanBGOpacity=e.captionBackgroundOpacity,this._fontColor=e.fontColor,this._fontOpacity=e.fontOpacity,this._edgeAttribute=e.edgeAttribute,this._edgeRGB=e.edgeRGB,e.fontSize>100?this.fittextRatio=.02:e.fontSize<=50?this.fittextRatio=.063:e.fontSize<=60?this.fittextRatio=.05:e.fontSize<=70?this.fittextRatio=.035:e.fontSize<=80?this.fittextRatio=.03:e.fontSize<90?this.fittextRatio=.027:e.fontSize<=100&&(this.fittextRatio=.022),this._fittextCompressRate=Math.round(((this._MAX_FONTSIZE-e.fontSize)*this.fittextRatio+this._FITTEXT_OFFSET)*100)/100;if(this._mainSubtitleDiv&&this._styleElement){e.textStroke?this._mainSubtitleDiv.style.webkitTextStroke=e.textStroke:this._mainSubtitleDiv.style.webkitTextStroke=null;if(e.fonts.length>0){for(var n=0;n<e.fonts.length;n++)e.fonts[n].style===0?this._mainSubtitleDiv.style.fontFamily=e.fonts[n].name:(r=e.fonts[n].name!==""?",":"",t+=this._fontStyleLookup[e.fonts[n].style].className+"{font-family:"+e.fonts[n].name+r+this._fontStyleLookup[e.fonts[n].style].defaultFont+" !important;} ");this._styleElement.innerHTML=t}}this._mainSubtitleDiv&&this._redraw()},n}),n("PlaybackAgent",["util/CommonTools","util/AsyncAgent","MessageBroker","WebVTTSubtitleRenderer"],function(e,t,n,r){function i(){var e=this;this._messageBroker=n,this._messageBroker.registerTarget(this),this._bufferedDuration=0,this._streamBitrate=null,this._error=null,this._audioTracks=[],this._subtitlingTracks=[],this._maxBandwidth=0,this._id3TagIdentifier=0,this._id3TagVersion=0,this._id3TagTimestamp=0,this._id3FrameLookup={},this._webVTTSubtitleRenderer=new r,this.addEventListener("webVTTSubtitleChanged",function(t,n){e._webVTTSubtitleRenderer.onWebVTTSubtitleChanged(t,n)}),this.addEventListener("viewDidChange",function(t){e._webVTTSubtitleRenderer.onViewDidChange(t)}),this.addEventListener("tracksChanged",function(){e._checkForActiveSubtitles()})}return i.prototype.getName=function(){return"playbackAgent"},i.prototype.activateTrack=function(e){if(!e.active){var t=this._messageBroker.createMessage("playbackAgent",this,"activateTrack",[e]),n=this._messageBroker.sendMessage(t,!0);return n&&this._updateTracks(e,!0),n}return!1},i.prototype.deactivateTrack=function(e){if(e.type!==this.TrackType.AUDIO&&e.active){var t=this._messageBroker.createMessage("playbackAgent",this,"deactivateTrack",[e]),n=this._messageBroker.sendMessage(t,!0);return n&&this._updateTracks(e,!1),n}return!1},i.prototype._updateTracks=function(e,t){var n=[],r;e.type===this.TrackType.AUDIO?n=this.audioTracks:e.type===this.TrackType.SUBTITLE&&(n=this.subtitlingTracks);if(e.type!==this.TrackType.AUDIO||n.length>1)for(var r=0;r<n.length;r++)!t||e.language!==n[r].language||e.name!==n[r].name?n[r].active=!1:t&&e.language===n[r].language&&e.name===n[r].name&&(n[r].active=!0);this._checkForActiveSubtitles()},i.prototype._checkForActiveSubtitles=function(){for(var e=0;e<this.subtitlingTracks.length;e++)if(this.subtitlingTracks[e].active){this._webVTTSubtitleRenderer._subtitlesActivated();return}this._webVTTSubtitleRenderer._subtitlesDeactivated()},Object.defineProperty(i.prototype,"bufferedDuration",{get:function(){var e=this._messageBroker.createMessage("playbackAgent",this,"getBufferedDuration",[]);return this._messageBroker.sendMessage(e,!0)},enumerable:!0,configurable:!1}),Object.defineProperty(i.prototype,"streamBitrate",{get:function(){return this._streamBitrate?this._streamBitrate:null},enumerable:!0,configurable:!1}),Object.defineProperty(i.prototype,"error",{get:function(){return this._error},enumerable:!0,configurable:!1}),Object.defineProperty(i.prototype,"audioTracks",{get:function(){return this._audioTracks},enumerable:!0,configurable:!1}),Object.defineProperty(i.prototype,"subtitlingTracks",{get:function(){return this._subtitlingTracks},enumerable:!0,configurable:!1}),Object.defineProperty(i.prototype,"maxBandwidth",{get:function(){return this._maxBandwidth},set:function(e){this._log("maxBandwidth","Setting maxBandwidth to "+e);var t=this._messageBroker.createMessage("videoAgent",this,"setMaxBandwidth",[e]);this._messageBroker.sendMessage(t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"ID3Tag",{get:function(){var e=this;return this._id3TagIdentifier?{identifier:this._id3TagIdentifier,version:this._id3TagVersion,timestamp:Math.round(this._id3TagTimestamp*1e3)/1e3,getFrameById:function(t){return e._id3FrameLookup[t]?e._id3FrameLookup[t]:[]}}:null},enumerable:!0,configurable:!1}),i.prototype.TPlaybackError={PLAYBACK_DEMUXING_ERROR:1,PLAYBACK_DECODING_ERROR:2,PLAYBACK_DESCRAMBLING_ERROR:3,PLAYBACK_CONTAINER_NOT_SUPPORTED:100,PLAYBACK_CODEC_NOT_SUPPORTED:101},i.prototype.TrackType={AUDIO:0,SUBTITLE:2},e.extend(i.prototype,t),i}),n("CCSettingsAgent",["util/CommonTools","util/AsyncAgent","MessageBroker"],function(e,t,n){function r(){this._DEFAULT_FONT="Tahoma",this._characterColor=this.TCCColor.COLOR_DEFAULT,this._characterOpacity=this.TCCOpacity.OPACITY_DEFAULT,this._characterSize=100,this._fonts=[{name:this._DEFAULT_FONT,style:this.TCCFontStyle.STYLE_DEFAULT},{name:"Courier New",style:this.TCCFontStyle.STYLE_MONOSPACED_SERIFS},{name:"Times Roman",style:this.TCCFontStyle.STYLE_PROPORTIONALLY_SPACED_SERIFS},{name:"Windings",style:this.TCCFontStyle.STYLE_MONOSPACED_SANS_SERIFS},{name:"Century Gothic",style:this.TCCFontStyle.STYLE_PROPORTIONALLY_SPACED_SANS_SERIFS},{name:"Lucinda Casual",style:this.TCCFontStyle.STYLE_CASUAL},{name:"Coronet",style:this.TCCFontStyle.STYLE_CURSIVE},{name:"Engravers Gothic",style:this.TCCFontStyle.STYLE_SMALL_CAPITALS}],this._captionBackgroundColor=this.TCCColor.COLOR_DEFAULT,this._captionBackgroundOpacity=this.TCCOpacity.OPACITY_DEFAULT,this._characterEdgeAttributes=this.TCCEdgeAttribute.EDGE_DEFAULT,this._characterEdgeColor=this.TCCColor.COLOR_DEFAULT,this._captionWindowColor=this.TCCColor.COLOR_DEFAULT,this._captionWindowOpacity=this.TCCOpacity.OPACITY_DEFAULT,this._createFontLookup(),this._createColorsLookup(),this._createOpacitiesLookup(),this._createEdgeAttributesLookup(),this._createDefaultFontTypesLookup()}return r.prototype._createFontLookup=function(){this._fontLookup={},this._fontLookup[this.TCCFontStyle.STYLE_DEFAULT]=["Courier","Courier New","Book Antiqua","Bookman Old Style","Century","Garamond","Georgia","MS Serif","Palatino Linotype","Times New Roman","Lucida Console","Lucida Sans Typewriter","Terminal","Arial","Arial Black","Arial Narrow","Century Gothic","Impact","Lucida Sans Unicode","MS Sans Serif","Tahoma","Trebuchet MS","Verdana","Comic Sans MS","Bradley Hand ITC","Monotype Corsiva","Papyrus"],this._fontLookup[this.TCCFontStyle.STYLE_MONOSPACED_SERIFS]=["Courier","Courier New"],this._fontLookup[this.TCCFontStyle.STYLE_PROPORTIONALLY_SPACED_SERIFS]=["Book Antiqua","Bookman Old Style","Century","Garamond","Georgia","MS Serif","Palatino Linotype","Times New Roman"],this._fontLookup[this.TCCFontStyle.STYLE_MONOSPACED_SANS_SERIFS]=["Lucida Console","Lucida Sans Typewriter","Terminal"],this._fontLookup[this.TCCFontStyle.STYLE_PROPORTIONALLY_SPACED_SANS_SERIFS]=["Arial","Arial Black","Arial Narrow","Century Gothic","Impact","Lucida Sans Unicode","MS Sans Serif","Tahoma","Trebuchet MS","Verdana"],this._fontLookup[this.TCCFontStyle.STYLE_CASUAL]=["Comic Sans MS"],this._fontLookup[this.TCCFontStyle.STYLE_CURSIVE]=["Bradley Hand ITC","Monotype Corsiva","Papyrus"],this._fontLookup[this.TCCFontStyle.STYLE_SMALL_CAPITALS]=["Courier","Courier New","Book Antiqua","Bookman Old Style","Century","Garamond","Georgia","MS Serif","Palatino Linotype","Times New Roman","Lucida Console","Lucida Sans Typewriter","Terminal","Arial","Arial Black","Arial Narrow","Century Gothic","Impact","Lucida Sans Unicode","MS Sans Serif","Tahoma","Trebuchet MS","Verdana","Comic Sans MS","Bradley Hand ITC","Monotype Corsiva","Papyrus"]},r.prototype._createColorsLookup=function(){this._cssStylesLookupForColors={},this._cssStylesLookupForColors[this.TCCColor.COLOR_DEFAULT]="0,0,0",this._cssStylesLookupForColors[this.TCCColor.COLOR_WHITE]="255,255,255",this._cssStylesLookupForColors[this.TCCColor.COLOR_BLACK]="0,0,0",this._cssStylesLookupForColors[this.TCCColor.COLOR_RED]="255,0,0",this._cssStylesLookupForColors[this.TCCColor.COLOR_GREEN]="0,128,0",this._cssStylesLookupForColors[this.TCCColor.COLOR_BLUE]="0,0,255",this._cssStylesLookupForColors[this.TCCColor.COLOR_YELLOW]="255,255,0",this._cssStylesLookupForColors[this.TCCColor.COLOR_MAGENTA]="255,0,255",this._cssStylesLookupForColors[this.TCCColor.COLOR_CYAN]="0,255,255"},r.prototype._createEdgeAttributesLookup=function(){this._cssStylesLookupForEdgeAttributes={},this._cssStylesLookupForEdgeAttributes[this.TCCEdgeAttribute.EDGE_DEFAULT]=null,this._cssStylesLookupForEdgeAttributes[this.TCCEdgeAttribute.EDGE_NONE]="NONE",this._cssStylesLookupForEdgeAttributes[this.TCCEdgeAttribute.EDGE_RAISED]="RAISED",this._cssStylesLookupForEdgeAttributes[this.TCCEdgeAttribute.EDGE_DEPRESSED]="DEPRESSED",this._cssStylesLookupForEdgeAttributes[this.TCCEdgeAttribute.EDGE_UNIFORM]="UNIFORM",this._cssStylesLookupForEdgeAttributes[this.TCCEdgeAttribute.EDGE_DROP_SHADOWED]="SHADOW"},r.prototype._createOpacitiesLookup=function(){this._cssStylesLookupForOpacities={},this._cssStylesLookupForOpacities[this.TCCOpacity.OPACITY_DEFAULT]=1,this._cssStylesLookupForOpacities[this.TCCOpacity.OPACITY_TRANSPARENT]=0,this._cssStylesLookupForOpacities[this.TCCOpacity.OPACITY_SEMI_TRANSPARENT_25]=.25,this._cssStylesLookupForOpacities[this.TCCOpacity.OPACITY_SEMI_TRANSPARENT_75]=.75,this._cssStylesLookupForOpacities[this.TCCOpacity.OPACITY_OPAQUE]=1},r.prototype._createDefaultFontTypesLookup=function(){this._defaultFontLookupForFontTypes={},this._defaultFontLookupForFontTypes[this.TCCFontStyle.STYLE_DEFAULT]="",this._defaultFontLookupForFontTypes[this.TCCFontStyle.STYLE_MONOSPACED_SERIFS]=", monospaced",this._defaultFontLookupForFontTypes[this.TCCFontStyle.STYLE_PROPORTIONALLY_SPACED_SERIFS]=", serif",this._defaultFontLookupForFontTypes[this.TCCFontStyle.STYLE_MONOSPACED_SANS_SERIFS]=", sans-serif",this._defaultFontLookupForFontTypes[this.TCCFontStyle.STYLE_PROPORTIONALLY_SPACED_SANS_SERIFS]=", sans-serif",this._defaultFontLookupForFontTypes[this.TCCFontStyle.STYLE_CASUAL]="",this._defaultFontLookupForFontTypes[this.TCCFontStyle.STYLE_CURSIVE]=", cursive",this._defaultFontLookupForFontTypes[this.TCCFontStyle.STYLE_SMALL_CAPITALS]=""},r.prototype.getSystemFonts=function(e){return this._fontLookup[e]?this._fontLookup[e]:[]},r.prototype.getName=function(){return"ccSettingsAgent"},r.prototype._validateColor=function(e){return e<-1||e>7?this.TCCColor.COLOR_DEFAULT:e},r.prototype._validateOpacity=function(e){return e!==-1&&e!==0&&e!==25&&e!==75&&e!==100?this.TCCOpacity.OPACITY_DEFAULT:e},Object.defineProperty(r.prototype,"characterColor",{get:function(){return this._characterColor},set:function(e){this._characterColor=this._validateColor(e),this._fireSettingsChangedEvent()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"characterOpacity",{get:function(){return this._characterOpacity},set:function(e){this._characterOpacity=this._validateOpacity(e),this._createEdgeAttributesLookup(),this._fireSettingsChangedEvent()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"characterSize",{get:function(){return this._characterSize},set:function(e){e<50?e=50:e>200&&(e=200),e>=50&&e<=200&&(this._characterSize=e,this._fireSettingsChangedEvent())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"fonts",{get:function(){return this._fonts},set:function(e){this._fonts=e,this._fireSettingsChangedEvent()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"captionBackgroundColor",{get:function(){return this._captionBackgroundColor},set:function(e){this._captionBackgroundColor=this._validateColor(e),this._fireSettingsChangedEvent()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"captionBackgroundOpacity",{get:function(){return this._captionBackgroundOpacity},set:function(e){this._captionBackgroundOpacity=this._validateOpacity(e),this._fireSettingsChangedEvent()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"characterEdgeAttributes",{get:function(){return this._characterEdgeAttributes},set:function(e){if(e<-1||e>4)e=this.TCCEdgeAttribute.EDGE_DEFAULT;this._characterEdgeAttributes=e,this._fireSettingsChangedEvent()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"characterEdgeColor",{get:function(){return this._characterEdgeColor},set:function(e){this._characterEdgeColor=this._validateColor(e),this._createEdgeAttributesLookup(),this._fireSettingsChangedEvent()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"captionWindowColor",{get:function(){return this._captionWindowColor},set:function(e){this._captionWindowColor=this._validateColor(e),this._fireSettingsChangedEvent()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"captionWindowOpacity",{get:function(){return this._captionWindowOpacity},set:function(e){this._captionWindowOpacity=this._validateOpacity(e),this._fireSettingsChangedEvent()},enumerable:!0,configurable:!0}),r.prototype.TCCFontStyle={STYLE_DEFAULT:0,STYLE_MONOSPACED_SERIFS:1,STYLE_PROPORTIONALLY_SPACED_SERIFS:2,STYLE_MONOSPACED_SANS_SERIFS:3,STYLE_PROPORTIONALLY_SPACED_SANS_SERIFS:4,STYLE_CASUAL:5,STYLE_CURSIVE:6,STYLE_SMALL_CAPITALS:7},r.prototype.TCCColor={COLOR_DEFAULT:-1,COLOR_WHITE:0,COLOR_BLACK:1,COLOR_RED:2,COLOR_GREEN:3,COLOR_BLUE:4,COLOR_YELLOW:5,COLOR_MAGENTA:6,COLOR_CYAN:7},r.prototype.TCCOpacity={OPACITY_DEFAULT:-1,OPACITY_TRANSPARENT:0,OPACITY_SEMI_TRANSPARENT_25:25,OPACITY_SEMI_TRANSPARENT_75:75,OPACITY_OPAQUE:100},r.prototype.TCCEdgeAttribute={EDGE_DEFAULT:-1,EDGE_NONE:0,EDGE_RAISED:1,EDGE_DEPRESSED:2,EDGE_UNIFORM:3,EDGE_DROP_SHADOWED:4},r.prototype._fireSettingsChangedEvent=function(){var e,t=this._characterEdgeColor===this.TCCColor.COLOR_DEFAULT?null:this._cssStylesLookupForColors[this._characterEdgeColor];this._captionWindowColor===this.TCCColor.COLOR_DEFAULT?e="rgba("+this._cssStylesLookupForColors[this._captionWindowColor]+", 0)":e="rgba("+this._cssStylesLookupForColors[this._captionWindowColor]+","+this._cssStylesLookupForOpacities[this._captionWindowOpacity]+")";var n={fontColor:this._characterColor===this.TCCColor.COLOR_DEFAULT?null:this._cssStylesLookupForColors[this._characterColor],fontOpacity:this._characterOpacity===this.TCCOpacity.OPACITY_DEFAULT?null:this._cssStylesLookupForOpacities[this._characterOpacity],fontSize:this._characterSize,fonts:this._fonts,captionBackgroundColor:this._captionBackgroundColor===this.TCCColor.COLOR_DEFAULT?null:this._cssStylesLookupForColors[this._captionBackgroundColor],captionBackgroundOpacity:this._captionBackgroundOpacity===this.TCCOpacity.OPACITY_DEFAULT?null:this._cssStylesLookupForOpacities[this._captionBackgroundOpacity],edgeRGB:t,edgeAttribute:this._cssStylesLookupForEdgeAttributes[this._characterEdgeAttributes],captionWindowColor:e};this._fireEvent("ccSettingsChanged",n)},e.extend(r.prototype,t),r}),n("RenderingAgent",["util/CommonTools","util/AsyncAgent","MessageBroker"],function(e,t,n){function r(){this._messageBroker=n,this._messageBroker.registerTarget(this)}return r.prototype.getName=function(){return"renderingAgent"},Object.defineProperty(r.prototype,"video",{get:function(){var e=this._messageBroker.createMessage("renderingAgent",this,"getVideoObject",[]);return this._messageBroker.sendMessage(e,!0)},enumerable:!0,configurable:!1}),e.extend(r.prototype,t),r}),n("SecureStorageAgent",["util/CommonTools","util/AsyncAgent","MessageBroker"],function(e,t,n){function r(){this._messageBroker=n,this._messageBroker.registerTarget(this)}return r.prototype.getItem=function(e){var t=this._messageBroker.createMessage("secureStorageAgent",this,"getItem",[e]);return this._messageBroker.sendMessage(t,!0)},r.prototype.setItem=function(e,t){t=typeof t=="number"?t+"":t;var n=this._messageBroker.createMessage("secureStorageAgent",this,"setItem",[e,t]);return this._messageBroker.sendMessage(n,!1),!0},r.prototype.removeItem=function(e){var t=this._messageBroker.createMessage("secureStorageAgent",this,"removeItem",[e]);this._messageBroker.sendMessage(t,!1)},r.prototype.clear=function(){var e=this._messageBroker.createMessage("secureStorageAgent",this,"clear",[]);this._messageBroker.sendMessage(e,!1)},r.prototype.getName=function(){return"secureStorageAgent"},e.extend(r.prototype,t),r}),n("fs",[],function(){function e(e,t){var n="";switch(e.code){case FileError.QUOTA_EXCEEDED_ERR:n="QUOTA_EXCEEDED_ERR";break;case FileError.NOT_FOUND_ERR:n="NOT_FOUND_ERR";break;case FileError.SECURITY_ERR:n="SECURITY_ERR";break;case FileError.INVALID_MODIFICATION_ERR:n="INVALID_MODIFICATION_ERR";break;case FileError.INVALID_STATE_ERR:n="INVALID_STATE_ERR";break;default:n="Unknown Error"}t&&t.apply(this,[n])}function t(e){return Array.prototype.slice.call(e||[],0)}function n(r,i){var s=r.root.createReader();s.readEntries(function(r){var s=n;if(r.length){var o=t(r);o.forEach(function(t){if(t.isDirectory){var n=t.createReader();n.readEntries(s,e)}else i.apply(this,[t])})}},e)}function r(){window.webkitRequestFileSystem(window.PERSISTENT,1048576,function(t){n(t,function(t){if(t.name==="pak.db"){var n=t.name.replace(".","_"),r="fs_file_"+n;t.remove(function(){var e=document.getElementById("#"+r);e!==null&&remove()},e)}},function(t){e(t,function(){})})})}return{deleteAllPersistentFiles:r}}),Object.defineProperty(window,"__NMPPluginLoaded",{get:function(){return function(e){NMP._pluginLoaded(e)}},configurable:!1}),n("NMP",["DRMAgent","UserAgent","VideoAgent","NetworkAgent","PlaybackAgent","CCSettingsAgent","RenderingAgent","SecureStorageAgent","fs"],function(e,n,r,i,s,o,u,a){function g(e){var t=document.createEvent("CustomEvent");t.initCustomEvent("nmp-extension-message",!0,!0,{action:e}),window.parent.document.dispatchEvent(t)}window.NMP=window.NMP||{},this._isReady=!1;var f=null,l,c,h,p,d,v,m;return NMP._deleteHttpFsFiles=function(){t(["fs"],function(e){e.deleteAllPersistentFiles(),NMP.ready=!1})},NMP._pluginLoaded=function(e){var n=this,i=t("MessageBroker");f=document.getElementsByTagName("nmp-video")[0]||new r,f.videoElement=f,f.drmAgent=window.NMP.drmAgent,f.userAgent=window.NMP.userAgent,f.networkAgent=window.NMP.networkAgent,f.playbackAgent=window.NMP.playbackAgent,f.ccSettingsAgent=window.NMP.ccSettingsAgent,f.renderingAgent=window.NMP.renderingAgent,f.secureStorageAgent=window.NMP.secureStorageAgent,f._subtitleElem&&(p._webVTTSubtitleRenderer.setMainSubtitleDiv(f._subtitleElem),d.addEventListener("ccSettingsChanged",function(e){p._webVTTSubtitleRenderer.onCCSettingsChanged(e)}),f.addEventListener("videoSizeChanged",function(){p._webVTTSubtitleRenderer.onVideoSizeChanged(f.videoWidth,f.videoHeight)}),h.addEventListener("availableBitratesChanged",function(){f._setPendingSetSource(!1)}),d._fireSettingsChangedEvent(),f.addEventListener("pause",function(){g("PowerSavingOn"),p._webVTTSubtitleRenderer.onPause()}),f.addEventListener("play",function(){g("PowerSavingOff"),p._webVTTSubtitleRenderer.onPlay()}),f.addEventListener("waiting",function(){p._webVTTSubtitleRenderer.onPause()}),f.addEventListener("seeking",function(){p._webVTTSubtitleRenderer.clearScreen()}),f.addEventListener("ended",function(){g("PowerSavingOn"),p._webVTTSubtitleRenderer.clearScreen()}),f.addEventListener("abort",function(){g("PowerSavingOn"),p._webVTTSubtitleRenderer.clearScreen()}),f.addEventListener("error",function(){g("PowerSavingOn"),p._webVTTSubtitleRenderer.clearScreen()})),g("RequestDeviceInformation"),window.NMP.videoAgent=f;var s=function(t){t.data==="NMPJSREADY"?(e.removeEventListener("message",s),n._isReady=!0,f.onload&&typeof f.onload=="function"&&f.onload.call()):t.data==="NMPJSERROR"&&(e.removeEventListener("message",s),console.error("JS Bridge Creation Failed"),f.onerror&&typeof f.onerror=="function"&&f.onerror.call())};i.setPluginInstance(e),e.addEventListener("message",s)},l=new e,c=new n,h=new i,p=new s,d=new o,v=new u,m=new a,window.NMP.drmAgent=l,window.NMP.userAgent=c,window.NMP.networkAgent=h,window.NMP.playbackAgent=p,window.NMP.ccSettingsAgent=d,window.NMP.renderingAgent=v,window.NMP.secureStorageAgent=m,Object.defineProperty(window.NMP,"ready",{get:function(){return this._isReady}}),Object.defineProperty(window.NMP,"buildNumber",{get:function(){return"Release#38"}}),window.NMP}),t("NMP")}();